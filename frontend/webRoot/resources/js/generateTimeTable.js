var possibleData = [
  {
    "isugrade" : "3",
    "banno" : "2",
    "isugbnm" : "전공심화",
    "yungyuknm" : "영역없음",
    "suupno2" : "13318",
    "haksuno" : "CSE4006",
    "gwamoknm" : "소프트웨어공학",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "유민수",
    "hakjeom" : "3",
    "ironsigan" : "3",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "30/60",
    "suuptimes" : [
      "화(09:00-10:30)",
      "목(09:00-10:30)"
    ],
    "suuproomnms" : [
      "서울 정보통신관 508강의실",
      "서울 정보통신관 508강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "컴퓨터전공",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "2",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "화",
          "Start_time" : "09",
          "Start_minute" : "00",
          "End_time" : "10",
          "End_minute" : "30"
        },
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "목",
          "Start_time" : "09",
          "Start_minute" : "00",
          "End_time" : "10",
          "End_minute" : "30"
        }
      ]
    }
  },
  {
    "isugrade" : "3",
    "banno" : "2",
    "isugbnm" : "전공심화",
    "yungyuknm" : "영역없음",
    "suupno2" : "10074",
    "haksuno" : "ITE4065",
    "gwamoknm" : "병렬프로그래밍",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "정형수",
    "hakjeom" : "3",
    "ironsigan" : "2",
    "silssigan" : "2",
    "suuptypenm" : "일반",
    "jehaninwon" : "60/50",
    "suuptimes" : [
      "월(17:30-19:30)",
      "목(18:00-20:00)"
    ],
    "suuproomnms" : [
      "서울 정보통신관 508강의실",
      "서울 정보통신관 509강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "컴퓨터전공",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "2",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "월",
          "Start_time" : "17",
          "Start_minute" : "30",
          "End_time" : "19",
          "End_minute" : "30"
        },
        {
          "Classroom" : "서울 정보통신관 509강의실",
          "Day" : "목",
          "Start_time" : "18",
          "Start_minute" : "00",
          "End_time" : "20",
          "End_minute" : "00"
        }
      ]
    }
  },
  {
    "isugrade" : "3",
    "banno" : "1",
    "isugbnm" : "기초필수",
    "yungyuknm" : "영역없음",
    "suupno2" : "15387",
    "haksuno" : "SYH0003",
    "gwamoknm" : "기업가정신과비즈니스리더십(HELP3)",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "송영수",
    "hakjeom" : "2",
    "ironsigan" : "2",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "3084/4000",
    "suuptimes" : [
      "시간미지정강좌"
    ],
    "suuproomnms" : [
      "  "
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "E-러닝 타입A",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "리더십센터(행정부서대학)",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "0",
      "TimesAndClass" : [ ]
    }
  },
  {
    "isugrade" : "",
    "banno" : "",
    "isugbnm" : "핵심교양",
    "yungyuknm" : "글로벌언어와문화영역",
    "suupno2" : "15024",
    "haksuno" : "CUL0025",
    "gwamoknm" : "영어발음의원리와교정",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "안미연",
    "hakjeom" : "2",
    "ironsigan" : "2",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "20/20",
    "suuptimes" : [
      "수(13:00-15:00)"
    ],
    "suuproomnms" : [
      "서울 인문관 403강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "영어전용",
    "bansosoknm" : "서울 대학",
    "gnjsosoknm" : "영어영문학과",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "1",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 인문관 403강의실",
          "Day" : "수",
          "Start_time" : "13",
          "Start_minute" : "00",
          "End_time" : "15",
          "End_minute" : "00"
        }
      ]
    }
  },
  {
    "isugrade" : "2",
    "banno" : "2",
    "isugbnm" : "전공핵심",
    "yungyuknm" : "영역없음",
    "suupno2" : "11735",
    "haksuno" : "ITE2038",
    "gwamoknm" : "데이터베이스시스템및응용",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "정형수",
    "hakjeom" : "3",
    "ironsigan" : "3",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "85/70",
    "suuptimes" : [
      "월(15:00-16:30)",
      "수(17:00-18:30)"
    ],
    "suuproomnms" : [
      "서울 정보통신관 508강의실",
      "서울 정보통신관 508강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "컴퓨터전공",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "2",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "월",
          "Start_time" : "15",
          "Start_minute" : "00",
          "End_time" : "16",
          "End_minute" : "30"
        },
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "수",
          "Start_time" : "17",
          "Start_minute" : "00",
          "End_time" : "18",
          "End_minute" : "30"
        }
      ]
    }
  }
];

var impossibleData = [
  {
    "isugrade" : "3",
    "banno" : "2",
    "isugbnm" : "전공심화",
    "yungyuknm" : "영역없음",
    "suupno2" : "13318",
    "haksuno" : "CSE4006",
    "gwamoknm" : "소프트웨어공학",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "유민수",
    "hakjeom" : "3",
    "ironsigan" : "3",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "30/60",
    "suuptimes" : [
      "화(09:00-10:30)",
      "목(09:00-10:30)"
    ],
    "suuproomnms" : [
      "서울 정보통신관 508강의실",
      "서울 정보통신관 508강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "컴퓨터전공",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "2",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "화",
          "Start_time" : "09",
          "Start_minute" : "00",
          "End_time" : "10",
          "End_minute" : "30"
        },
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "목",
          "Start_time" : "09",
          "Start_minute" : "00",
          "End_time" : "10",
          "End_minute" : "30"
        }
      ]
    }
  },
  {
    "isugrade" : "3",
    "banno" : "2",
    "isugbnm" : "전공심화",
    "yungyuknm" : "영역없음",
    "suupno2" : "10074",
    "haksuno" : "ITE4065",
    "gwamoknm" : "병렬프로그래밍",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "정형수",
    "hakjeom" : "3",
    "ironsigan" : "2",
    "silssigan" : "2",
    "suuptypenm" : "일반",
    "jehaninwon" : "60/50",
    "suuptimes" : [
      "월(17:30-19:30)",
      "목(18:00-20:00)"
    ],
    "suuproomnms" : [
      "서울 정보통신관 508강의실",
      "서울 정보통신관 509강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "컴퓨터전공",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "2",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "월",
          "Start_time" : "17",
          "Start_minute" : "30",
          "End_time" : "19",
          "End_minute" : "30"
        },
        {
          "Classroom" : "서울 정보통신관 509강의실",
          "Day" : "목",
          "Start_time" : "18",
          "Start_minute" : "00",
          "End_time" : "20",
          "End_minute" : "00"
        }
      ]
    }
  },
  {
    "isugrade" : "3",
    "banno" : "1",
    "isugbnm" : "기초필수",
    "yungyuknm" : "영역없음",
    "suupno2" : "15387",
    "haksuno" : "SYH0003",
    "gwamoknm" : "기업가정신과비즈니스리더십(HELP3)",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "송영수",
    "hakjeom" : "2",
    "ironsigan" : "2",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "3084/4000",
    "suuptimes" : [
      "시간미지정강좌"
    ],
    "suuproomnms" : [
      "  "
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "E-러닝 타입A",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "리더십센터(행정부서대학)",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "0",
      "TimesAndClass" : [ ]
    }
  },
  {
    "isugrade" : "",
    "banno" : "",
    "isugbnm" : "핵심교양",
    "yungyuknm" : "글로벌언어와문화영역",
    "suupno2" : "15024",
    "haksuno" : "CUL0025",
    "gwamoknm" : "영어발음의원리와교정",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "안미연",
    "hakjeom" : "2",
    "ironsigan" : "2",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "20/20",
    "suuptimes" : [
      "수(13:00-15:00)"
    ],
    "suuproomnms" : [
      "서울 인문관 403강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "영어전용",
    "bansosoknm" : "서울 대학",
    "gnjsosoknm" : "영어영문학과",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "1",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 인문관 403강의실",
          "Day" : "수",
          "Start_time" : "13",
          "Start_minute" : "00",
          "End_time" : "15",
          "End_minute" : "00"
        }
      ]
    }
  },
  {
    "isugrade" : "2",
    "banno" : "2",
    "isugbnm" : "전공핵심",
    "yungyuknm" : "영역없음",
    "suupno2" : "11735",
    "haksuno" : "ITE2038",
    "gwamoknm" : "데이터베이스시스템및응용",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "정형수",
    "hakjeom" : "3",
    "ironsigan" : "3",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "85/70",
    "suuptimes" : [
      "월(15:00-16:30)",
      "수(17:00-18:30)"
    ],
    "suuproomnms" : [
      "서울 정보통신관 508강의실",
      "서울 정보통신관 508강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "컴퓨터전공",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "2",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "월",
          "Start_time" : "15",
          "Start_minute" : "00",
          "End_time" : "16",
          "End_minute" : "30"
        },
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "수",
          "Start_time" : "17",
          "Start_minute" : "00",
          "End_time" : "18",
          "End_minute" : "30"
        }
      ]
    }
  },
  {
    "isugrade" : "2",
    "banno" : "2",
    "isugbnm" : "전공핵심",
    "yungyuknm" : "영역없음",
    "suupno2" : "11735",
    "haksuno" : "ITE2038",
    "gwamoknm" : "데이터베이스시스템및응용",
    "suupmsg" : "",
    "abekgb" : "N",
    "hakwinm" : "학사",
    "daepyogangsanm" : "정형수",
    "hakjeom" : "3",
    "ironsigan" : "3",
    "silssigan" : "0",
    "suuptypenm" : "일반",
    "jehaninwon" : "85/70",
    "suuptimes" : [
      "월(15:00-16:30)",
      "수(17:00-18:30)"
    ],
    "suuproomnms" : [
      "서울 정보통신관 508강의실",
      "서울 정보통신관 508강의실"
    ],
    "isujehanyn" : "O",
    "suuptypegb" : "",
    "bansosoknm" : "컴퓨터전공",
    "gnjsosoknm" : "컴퓨터전공",
    "best_teacher" : "false",
    "SecondData" : {
      "Times_number" : "2",
      "TimesAndClass" : [
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "일",
          "Start_time" : "15",
          "Start_minute" : "00",
          "End_time" : "16",
          "End_minute" : "30"
        },
        {
          "Classroom" : "서울 정보통신관 508강의실",
          "Day" : "수",
          "Start_time" : "18",
          "Start_minute" : "00",
          "End_time" : "19",
          "End_minute" : "00"
        }
      ]
    }
  }
];

function isPossibleData(lectureDataArray) {
  // 2차원 맵으로 시간표의 중복을 체크한다.

  //        일(0)  월(1)  화(2)  수(3)  목(4)  금(5)  토(6)
  // 0700
  // 0730
  // 0800
  // 0830
  // 0900
  // 0930
  // 1000
  // 1030
  // .
  // .
  // .


  var timeTable = new Map();

  for (var idx in lectureDataArray) {
    var lectureData = lectureDataArray[idx]

    if (lectureData.SecondData.TimesAndClass.length == 0) {
      // console.log("no SecondData. continue for loop");
      continue;
    }

    // each lecture, iterate all time
    for (var j in lectureData.SecondData.TimesAndClass) {
      var classTimeData = lectureData.SecondData.TimesAndClass[j]

      // below three variables are all int.
      var day;
      var start;
      var end;

      switch (classTimeData.Day) {
        case '일': day = 0; break;
        case '월': day = 1; break;
        case '화': day = 2; break;
        case '수': day = 3; break;
        case '목': day = 4; break;
        case '금': day = 5; break;
        case '토': day = 6; break;
        default: 
          console.log("no time data. continue for loop");
          continue;
      }
      // console.log(day);
      start = parseInt(classTimeData.Start_time + classTimeData.Start_minute);
      end = parseInt(classTimeData.End_time + classTimeData.End_minute);

      // 30으로 끝나면 70을 더하고, 00으로 끝나면 30을 더해서 계속 체크해가자.

      do {
        // row는 시간, col이 요일이다.
        if (timeTable.get(start) == undefined) {
          timeTable.set(start, new Map());
        }

        // check whether time is duplicated
        var duplicated = timeTable.get(start).get(day);
        if (duplicated) {
          return false;
        } else {
          timeTable.get(start).set(day, true);
        }

        // check next time
        if (start % 100 == 0) {
          start += 30;
        } else {
          start += 70;
        }

      } while (start != end);

    }

  }
  return true;
}

// This powerSet function is from 
// https://codereview.stackexchange.com/questions/7001/generating-all-combinations-of-an-array
function powerSet(list, minLength, maxLength){
  var set = [],
    listSize = list.length,
    combinationsCount = (1 << listSize),
    combination;

  for (var i = 1; i < combinationsCount ; i++ ){
    var combination = [];
    
    // check the number of 1s.
    var bits = i;
    var numberOfElements = 0;
    do {
      if (bits & 1 == 1) {
        numberOfElements++;
      }
      bits >>= 1;
    } while (bits > 0);

    if (numberOfElements < minLength || numberOfElements > maxLength) {
      // it does not meet the requirements.
      continue;
    }

    for (var j=0;j<listSize;j++){
      if ((i & (1 << j))){
        combination.push(list[j]);
      }
    }
    set.push(combination);
  }
  return set;
}

function possibleTimeTableData(lectureDataArray, minLectureNumber, maxLectureNumber){
  var allSets = powerSet(lectureDataArray, minLectureNumber, maxLectureNumber);

  var resultArray = [];

  for (var idx in allSets) {
    if (isPossibleData(allSets[idx])) {
      resultArray.push(allSets[idx]);
    }
  }

  return resultArray;
}
